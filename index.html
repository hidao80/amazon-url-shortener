<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAfCAYAAACGVs+MAAAACXBIWXMAAAHtAAAB7QEM2vLaAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAA0NJREFUSIntl01oXFUUx3/nzkfmBZtJJ62mwWrFz6pos4koIi4kGxexXYjERUFrQWha6qoUrRqrQalgZxZqsTh+dtEIunFhERRtIn4EbamISvoRIYm2k0mG+Z65x0WccZrkvRllGF307M75/8/9/+997777rgCkd6zpEVPeI9ALnEN5zYnNfUGDkd8ducWWda8gNyKctcrL7dHEWC1Ht/e0FzZc/SaR9bcDkJj6IZiYfESyO8LXYMy3QKSGbxG2Ogfn3q0nnhuK9KvoR0CoplxGdZsTS8arJl+4873A1jcekp6bDYDO/GSL8UePGjHmxSXiAEaVmD5D0EtctxNQ0cNLxAF8iERTQ5etrVa6ruqtiANI902GyPpNRuGulQYX6Mwkw7d6Gcg4XZuAK13gVT4TvLeaFfOlZYxSoWSA1W4CxrpjAD5L2AsX6KwmyanR8lg8VUnL42+nuHDuA7/XAM2Mtie/G84Nx2ZK4+88DEA6+X7o6YnXW2YAILRv4hBwqLZmXLgti5auQH5n54AVeQ4losios9Cxp2UG8rtW32aVUXRx0oLuynfM51v2CKzqZpasuMKDnisgyP25nZFrXQmqGxs1oMhaWV6+fNGAE8Z034CvdwuEu2sJuxsVAKCQpnzqGDo5ji783lCLn6Dj990xSGDz8/9Iyy18fYPYX7+k+NZjaKq+CWM6uv2BgWebIl4d9Lq7kSuuR6w4dbk4HYJp/maQDX1YsevqGyhktOnqgE6fApHzdQ3Y+dlyaSzeXPHzp9GpEwgs1OP6yS0Uyx+PBPjtBKZvEFm15t8r5zPYnz+n9Nmr6Pw0yAobb5kBQFN/UDoeh4kPkUDNP0gw9ImY4LRrty2u00K2/+/copkEWNuw54vfvmwSzV6k8FIoOv+pW3NuqOs+FdvvhjcS//lpeMnAJQP/CwMZN1DVl/ZqtmqzXjioZ3/FwIQLVnDaAie9mp1Q8HvcP7clRKv3Q1Fd6WyeMarmKWD5rQXdLwdmPWcgB2bTiDzhgo44ryTPVDKDGQUKS0hHTHvswtdq5B7gq78IkwKPh6LJ/V7ilXAOJg4b9AGEk4v98gsi25xoYl8try2W+FGQAdBvgNPASCgyN/wnNl4hNCN8x/UAAAAASUVORK5CYII=">
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW"
      crossorigin="anonymous"
    ></script>
    <style>
        body {
            margin: 2rem;
        }
    </style>
    <title>Amazon URL Shortener</title>
  </head>
  <body>
    <label for="basic-url" class="form-label">短縮したいAmazon商品URLを入力してください。</label>
    <div class="input-group mb-3">
      <input
        type="text"
        class="form-control"
        id="input-url"
        aria-describedby="basic-addon3"
      />
      <button class="btn btn-outline-secondary" type="button" id="shortener-btn">短縮してコピー</button>
    </div>
    </div>
    <div class="alert alert-success visually-hidden" role="alert" id="shortener-result">
    </div>
    <script>
        function urlShorten()
        {
            const inputUrl = document.getElementById('input-url').value;
            const fields = inputUrl.split('/');
            let shortUrl = '';
            for (let field of fields) {
              length = field.indexOf('?');
              non_param = length > 0 ? field.substring(0, length) : field;
              shortUrl += non_param.length > 0 && (non_param.indexOf('%') + non_param.indexOf('=')) === -2 ? non_param + '/' : '';
            }

            shortUrl = shortUrl.replace(/^https:\/(www\.)?/, 'https://').replace(/gp\/product/, 'dp');

            const msg = document.getElementById('shortener-result');
            copyToClipboard(shortUrl)
            .then(result => msg.innerHTML = result);
            msg.classList.remove('visually-hidden');
        }

        async function copyToClipboard(text) {
            try {
                await navigator.clipboard.writeText(text)
                return '<strong>' + text + '</strong>をクリップボードにコピーしました。';
            } catch (error) {
                return '<strong>' + text + '</strong>をコピーできませんでした。';
            }
        }

        document.getElementById('shortener-btn').addEventListener('click', () => {
            urlShorten();
        });
    </script>
  </body>
</html>
