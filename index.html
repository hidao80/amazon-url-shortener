<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" href="img/logo.svg">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW"
        crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css"
        integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        body {
            margin: 2rem;
        }
    </style>
    <title>Amazon URL Shortener</title>
    <meta property="og:description" content="An account-free web application that shortens Amazon product URLs without using a special domain.">
    <meta property="og:title" content="Amazon URL Shortener">
    <meta property="og:image" content="https://hidao80.github.io/amazon-url-shortener/img/logo.svg">
    <meta property="og:image:width" content="600">
    <meta property="og:image:height" content="315">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://hidao80.github.io/amazon-url-shortener/">
</head>

<body>
    <label for="basic-url" class="form-label">Enter the Amazon product URL you want to shorten.</label>
    <div class="input-group mb-3">
        <input type="text" class="form-control" id="input-url" aria-describedby="basic-addon3" />
        <button class="btn btn-outline-secondary" type="button" id="shortener-btn">Shorten and copy</button>
    </div>
    </div>
    <div class="alert alert-success visually-hidden" role="alert" id="shortener-result">
    </div>
    <script>
        // Get language settings
        let language = (window.navigator.languages && window.navigator.languages[0]) ||
            window.navigator.language ||
            window.navigator.userLanguage ||
            window.navigator.browserLanguage;

        // Multilingual dictionary object
        const __ = {
            "en": {
                "Enter the Amazon product URL or Wish List URL you wish to shorten.": "Enter the Amazon product URL or Wish List URL you wish to shorten.",
                "Shorten and copy": "Shorten and copy",
                "Copied the URL to the clipboard; ": "Copied the URL to the clipboard; ",
                "Could not copy the URL; ": "Could not copy the URL; "
            },
            "ja": {
                "Enter the Amazon product URL or Wish List URL you wish to shorten.": "短縮したいAmazon商品URLまたはほしいものリストURLを入力してください。",
                "Shorten and copy": "短縮してコピー",
                "Copied the URL to the clipboard; ": "URLをクリップボードにコピーしました： ",
                "Could not copy the URL; ": "URLをコピーできませんでした："
            }
        };

        // Show English for undefined languages
        if (__[language] === undefined) {
            language = "en";
        }

        function urlShorten() {
            const inputUrl = document.getElementById('input-url').value;
            const fields = inputUrl.split('/');
            let shortUrl = '';
            for (let field of fields) {
                length = field.indexOf('?');
                non_param = length > 0 ? field.substring(0, length) : field;
                shortUrl += non_param.length > 0 && (non_param.indexOf('%') + non_param.indexOf('=')) === -2 ? non_param + '/' : '';
            }

            // for product url
            shortUrl = shortUrl.replace(/^https:\/(www\.)?/, 'https://').replace(/gp\/product/, 'dp');

            // for wishlist url
            shortUrl = shortUrl.replace(/(hz|ls)\//g, '');

            const msg = document.getElementById('shortener-result');
            copyToClipboard(shortUrl)
                .then(result => msg.innerHTML = result);
            msg.classList.remove('visually-hidden');
        }

        async function copyToClipboard(text) {
            try {
                await navigator.clipboard.writeText(text)
                return __[language]['Copied the URL to the clipboard; '] + '<strong>' + text + '</strong>';
            } catch (error) {
                return __[language]['Could not copy the URL; '] + '<strong>' + text + '</strong>';
            }
        }

        document.getElementById('shortener-btn').addEventListener('click', () => {
            urlShorten();
        });

        // i18n
        document.getElementById('shortener-btn').innerHTML = __[language]['Shorten and copy'] + '&nbsp;<i class="fas fa-copy"></i>';
        document.querySelector('.form-label').innerHTML = __[language]['Enter the Amazon product URL or Wish List URL you wish to shorten.'];
    </script>
</body>

</html>